Streaming Community Detection
VOD-Based Presence Collection Design (Agentic-Ready)
Purpose
This document specifies how to extend an existing Twitch streaming community detection system to
ingest historical VOD chat data and convert it into presence snapshots compatible with a pipeline that
currently collects live chatters lists (presence only).
Core Design Principle
All ingestion sources must emit the same canonical record type: PresenceSnapshot. Downstream
systems must not depend on whether data came from live IRC/API or VOD chat replay.
Canonical Record: PresenceSnapshot
platform: twitch
source: live | vod
channel_login: string
channel_id: string | null
content_id: live:<timestamp> | vod:<vod_id>
bucket_start_ts: ISO timestamp | null
offset_s: integer | null
bucket_len_s: integer (default 60)
chatters: list[string] (lowercase, unique)
Invariants
- chatters must be unique
- bucket_len_s must be consistent system-wide
- exactly one of bucket_start_ts or offset_s must be non-null
- usernames must be normalized (lowercase)
VOD Collection Strategy
Twitch does not provide an official API for historical chat presence. VOD chat replays expose
messages, not presence. Therefore, VOD chat messages are transformed into synthetic presence
snapshots by time-bucketing message authors.
VOD Ingestion Pipeline
VOD Queue → Downloader → Raw JSON (S3) → Parser → Bucketizer → PresenceSnapshot Writer
→ Curated S3 Storage
Step 1: VOD Identification
Maintain a VOD queue containing vod_id, channel_login, status, attempt_count, and timestamps.
VODs can be discovered via recent broadcasts or manual insertion.
Step 2: VOD Chat Download
Use TwitchDownloader or Twitch-Chat-Downloader to retrieve chat replay JSON. Always store raw
output unmodified for replay/debugging.
Raw Storage Layout
s3://bucket/raw/vod_chat/channel=<login>/vod_id=<id>/chat.json
Step 3: Parsing
Extract only user_login and offset_seconds from each message. Ignore message text entirely.
Normalize usernames to lowercase.
Step 4: Bucketization
Group messages into fixed-size time buckets (default 60s). For each bucket, collect unique users who
spoke during that window.
Step 5: PresenceSnapshot Emission
For each bucket, emit a PresenceSnapshot with source=vod, content_id=vod:<id>,
offset_s=bucket_start, and chatters=list of users.
Curated Storage Layout
s3://bucket/curated/presence_snapshots/source=vod/channel=<login>/vod=<id>/part-*.parquet
Repeat Interaction Metrics
Repeat presence can be measured by counting distinct buckets or days per user-channel pair. Overlap
edges may be weighted by min(shared_bucket_counts).
AWS Execution Pattern
Run VOD ingestion as an ECS Fargate task triggered by EventBridge. Tasks claim VODs, download
chat, emit snapshots, and update ingest state.
Failure Handling
VOD ingestion is best-effort. Failures must not impact live ingestion. Retries should be bounded and
logged.
Summary
This design allows historical VOD chat data to integrate seamlessly into an existing presence-based
community detection system, preserving downstream logic and enabling scalable AWS-based
ingestion.